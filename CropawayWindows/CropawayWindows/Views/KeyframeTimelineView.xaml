<UserControl x:Class="CropawayWindows.Views.KeyframeTimelineView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:CropawayWindows.ViewModels"
             xmlns:models="clr-namespace:CropawayWindows.Models"
             mc:Ignorable="d"
             d:DataContext="{d:DesignInstance vm:KeyframeViewModel}"
             Background="{StaticResource PanelBrush}">

    <Grid>
        <Grid.RowDefinitions>
            <!-- Toolbar -->
            <RowDefinition Height="Auto" />
            <!-- Timeline bar with keyframe markers -->
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Toolbar -->
        <Border Grid.Row="0" Padding="8,4"
                BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
            <DockPanel>
                <!-- Left: Label + navigation -->
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Left" VerticalAlignment="Center">
                    <TextBlock Text="Keyframes" FontWeight="SemiBold" FontSize="12"
                               Foreground="{StaticResource TextPrimaryBrush}"
                               VerticalAlignment="Center" Margin="0,0,12,0" />

                    <!-- Previous keyframe -->
                    <Button Style="{StaticResource ToolbarButton}"
                            Command="{Binding GoToPreviousKeyframeCommand}"
                            ToolTip="Previous Keyframe"
                            Padding="4,3">
                        <TextBlock FontFamily="Segoe Fluent Icons"
                                   Text="{StaticResource IconSkipBackward}"
                                   FontSize="12" />
                    </Button>

                    <!-- Next keyframe -->
                    <Button Style="{StaticResource ToolbarButton}"
                            Command="{Binding GoToNextKeyframeCommand}"
                            ToolTip="Next Keyframe"
                            Padding="4,3" Margin="2,0">
                        <TextBlock FontFamily="Segoe Fluent Icons"
                                   Text="{StaticResource IconSkipForward}"
                                   FontSize="12" />
                    </Button>
                </StackPanel>

                <!-- Right: Add/Remove + Interpolation selector -->
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Right"
                            HorizontalAlignment="Right" VerticalAlignment="Center">

                    <!-- Interpolation type dropdown -->
                    <ComboBox x:Name="InterpolationCombo"
                              Width="100" Height="24"
                              FontSize="11"
                              Background="{StaticResource PanelBrush}"
                              Foreground="{StaticResource TextPrimaryBrush}"
                              BorderBrush="{StaticResource BorderBrush}"
                              IsEnabled="False"
                              SelectedIndex="0"
                              SelectionChanged="OnInterpolationChanged"
                              ToolTip="Interpolation Type"
                              Margin="0,0,8,0">
                        <ComboBoxItem Content="Linear" Tag="Linear" />
                        <ComboBoxItem Content="Ease In" Tag="EaseIn" />
                        <ComboBoxItem Content="Ease Out" Tag="EaseOut" />
                        <ComboBoxItem Content="Ease In/Out" Tag="EaseInOut" />
                        <ComboBoxItem Content="Hold" Tag="Hold" />
                    </ComboBox>

                    <!-- Add keyframe -->
                    <Button Style="{StaticResource ToolbarButton}"
                            Command="{Binding AddKeyframeCommand}"
                            ToolTip="Add Keyframe (Ctrl+K)"
                            Padding="4,3">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock FontFamily="Segoe Fluent Icons"
                                       Text="{StaticResource IconAdd}"
                                       FontSize="11" Margin="0,0,3,0" />
                            <TextBlock Text="Add" FontSize="11" />
                        </StackPanel>
                    </Button>

                    <!-- Remove keyframe -->
                    <Button Style="{StaticResource ToolbarButton}"
                            Command="{Binding RemoveKeyframeCommand}"
                            ToolTip="Remove Keyframe (Ctrl+Shift+K)"
                            Padding="4,3" Margin="2,0,0,0">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock FontFamily="Segoe Fluent Icons"
                                       Text="{StaticResource IconDelete}"
                                       FontSize="11" Margin="0,0,3,0" />
                            <TextBlock Text="Remove" FontSize="11" />
                        </StackPanel>
                    </Button>
                </StackPanel>

                <!-- Spacer -->
                <Border />
            </DockPanel>
        </Border>

        <!-- Timeline Area (custom drawn) -->
        <Grid Grid.Row="1" Margin="8,4">
            <!-- Click-to-seek overlay -->
            <Canvas x:Name="TimelineCanvas"
                    Background="Transparent"
                    ClipToBounds="True"
                    MouseLeftButtonDown="OnTimelineCanvasClick"
                    SizeChanged="OnTimelineCanvasSizeChanged">

                <!-- Timeline track background bar -->
                <Border x:Name="TrackBar"
                        Canvas.Left="0"
                        Canvas.Top="30"
                        Height="24"
                        CornerRadius="3"
                        Background="{StaticResource SurfaceBrush}"
                        BorderBrush="{StaticResource BorderBrush}"
                        BorderThickness="1" />

                <!-- Keyframe markers are added programmatically -->

                <!-- Playhead line -->
                <Line x:Name="PlayheadLine"
                      Y1="0" Y2="100"
                      StrokeThickness="1.5"
                      Stroke="White"
                      IsHitTestVisible="False" />
            </Canvas>

            <!-- Keyframe enabled indicator -->
            <StackPanel Orientation="Horizontal"
                        HorizontalAlignment="Left" VerticalAlignment="Bottom"
                        Margin="0,0,0,4">
                <Ellipse Width="8" Height="8" Margin="0,0,4,0"
                         VerticalAlignment="Center">
                    <Ellipse.Style>
                        <Style TargetType="Ellipse">
                            <Setter Property="Fill" Value="{StaticResource TextTertiaryBrush}" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding KeyframesEnabled}" Value="True">
                                    <Setter Property="Fill" Value="{StaticResource KeyframeBrush}" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Ellipse.Style>
                </Ellipse>
                <TextBlock FontSize="10" VerticalAlignment="Center"
                           Foreground="{StaticResource TextSecondaryBrush}">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Setter Property="Text" Value="Keyframes disabled" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding KeyframesEnabled}" Value="True">
                                    <Setter Property="Text" Value="Keyframes enabled" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>
                <TextBlock FontSize="10" Margin="8,0,0,0"
                           Foreground="{StaticResource TextTertiaryBrush}"
                           VerticalAlignment="Center">
                    <TextBlock.Text>
                        <Binding Path="Keyframes.Count" StringFormat="{}{0} keyframe(s)" />
                    </TextBlock.Text>
                </TextBlock>
            </StackPanel>
        </Grid>
    </Grid>
</UserControl>
