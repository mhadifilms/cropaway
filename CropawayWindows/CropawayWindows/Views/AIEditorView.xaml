<UserControl x:Class="CropawayWindows.Views.AIEditorView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:CropawayWindows.ViewModels"
             mc:Ignorable="d"
             d:DataContext="{d:DesignInstance vm:CropEditorViewModel}"
             Background="{StaticResource PanelBrush}">

    <Border Padding="12,10"
            BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,1,0,0">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- Header -->
            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,12">
                <TextBlock FontFamily="Segoe Fluent Icons"
                           Text="{StaticResource IconAI}"
                           FontSize="16"
                           Foreground="{StaticResource AccentBrush}"
                           VerticalAlignment="Center"
                           Margin="0,0,8,0" />
                <TextBlock Text="AI Object Tracking"
                           FontSize="14" FontWeight="SemiBold"
                           Foreground="{StaticResource TextPrimaryBrush}"
                           VerticalAlignment="Center" />
            </StackPanel>

            <!-- API Key section -->
            <StackPanel Grid.Row="1" Margin="0,0,0,10">
                <DockPanel Margin="0,0,0,4">
                    <TextBlock Text="fal.ai API Key" FontSize="11"
                               Foreground="{StaticResource TextSecondaryBrush}"
                               VerticalAlignment="Center" />
                    <Button x:Name="SetupApiKeyButton"
                            DockPanel.Dock="Right" HorizontalAlignment="Right"
                            Style="{StaticResource ToolbarButton}"
                            Click="OnSetupApiKeyClick"
                            Padding="4,2">
                        <TextBlock FontFamily="Segoe Fluent Icons"
                                   Text="{StaticResource IconSettings}"
                                   FontSize="12" ToolTip="Configure API Key" />
                    </Button>
                </DockPanel>

                <!-- API key status indicator -->
                <Border x:Name="ApiKeyStatusBorder"
                        CornerRadius="3" Padding="8,4"
                        Margin="0,2,0,0">
                    <StackPanel Orientation="Horizontal">
                        <Ellipse x:Name="ApiKeyStatusDot"
                                 Width="8" Height="8"
                                 Margin="0,0,6,0"
                                 VerticalAlignment="Center" />
                        <TextBlock x:Name="ApiKeyStatusText"
                                   FontSize="11"
                                   VerticalAlignment="Center" />
                    </StackPanel>
                </Border>
            </StackPanel>

            <!-- Separator -->
            <Separator Grid.Row="2" Style="{StaticResource PanelSeparator}" />

            <!-- Interaction Mode Selector -->
            <StackPanel Grid.Row="3" Margin="0,8,0,10">
                <TextBlock Text="Interaction Mode" FontSize="11"
                           Foreground="{StaticResource TextSecondaryBrush}"
                           Margin="0,0,0,6" />
                <StackPanel Orientation="Horizontal">
                    <!-- Point mode -->
                    <ToggleButton Style="{StaticResource CropModeToggle}"
                                  IsChecked="{Binding AiInteractionMode, Converter={StaticResource EnumBoolConverter}, ConverterParameter=Point}"
                                  Click="OnInteractionModePoint"
                                  ToolTip="Click on the object to track"
                                  Padding="8,5">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock FontFamily="Segoe Fluent Icons"
                                       Text="&#xE1E2;" FontSize="13" Margin="0,0,4,0" />
                            <TextBlock Text="Point" FontSize="11" />
                        </StackPanel>
                    </ToggleButton>

                    <!-- Box mode -->
                    <ToggleButton Style="{StaticResource CropModeToggle}"
                                  IsChecked="{Binding AiInteractionMode, Converter={StaticResource EnumBoolConverter}, ConverterParameter=Box}"
                                  Click="OnInteractionModeBox"
                                  ToolTip="Draw a box around the object"
                                  Padding="8,5" Margin="4,0,0,0">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock FontFamily="Segoe Fluent Icons"
                                       Text="&#xE003;" FontSize="13" Margin="0,0,4,0" />
                            <TextBlock Text="Box" FontSize="11" />
                        </StackPanel>
                    </ToggleButton>

                    <!-- Text mode -->
                    <ToggleButton Style="{StaticResource CropModeToggle}"
                                  IsChecked="{Binding AiInteractionMode, Converter={StaticResource EnumBoolConverter}, ConverterParameter=Text}"
                                  Click="OnInteractionModeText"
                                  ToolTip="Describe the object with text"
                                  Padding="8,5" Margin="4,0,0,0">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock FontFamily="Segoe Fluent Icons"
                                       Text="&#xE185;" FontSize="13" Margin="0,0,4,0" />
                            <TextBlock Text="Text" FontSize="11" />
                        </StackPanel>
                    </ToggleButton>
                </StackPanel>
            </StackPanel>

            <!-- Text prompt input -->
            <StackPanel Grid.Row="4" Margin="0,0,0,10">
                <TextBlock Text="Text Prompt" FontSize="11"
                           Foreground="{StaticResource TextSecondaryBrush}"
                           Margin="0,0,0,4" />
                <TextBox x:Name="PromptTextBox"
                         Style="{StaticResource DarkTextBox}"
                         Text="{Binding AiTextPrompt, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         Height="56"
                         AcceptsReturn="True"
                         TextWrapping="Wrap"
                         VerticalScrollBarVisibility="Auto"
                         FontSize="12">
                    <!-- Placeholder text via adorner alternative -->
                </TextBox>
                <TextBlock Text="Describe the object to track (e.g., &quot;person&quot;, &quot;car&quot;, &quot;ball&quot;)"
                           FontSize="10" Foreground="{StaticResource TextTertiaryBrush}"
                           Margin="0,3,0,0" TextWrapping="Wrap" />
            </StackPanel>

            <!-- Track Object button -->
            <Button Grid.Row="5"
                    x:Name="TrackButton"
                    Style="{StaticResource AccentButton}"
                    Click="OnTrackObjectClick"
                    HorizontalAlignment="Stretch"
                    Margin="0,4,0,10"
                    Padding="12,8">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                    <TextBlock FontFamily="Segoe Fluent Icons"
                               Text="{StaticResource IconAI}"
                               FontSize="14" Margin="0,0,8,0"
                               VerticalAlignment="Center" />
                    <TextBlock Text="Track Object" FontSize="13"
                               VerticalAlignment="Center" />
                </StackPanel>
            </Button>

            <!-- Status display (visibility managed in code-behind) -->
            <Border x:Name="StatusBorder" Grid.Row="6" Padding="8,6"
                    CornerRadius="4"
                    Background="{StaticResource SurfaceBrush}"
                    Margin="0,0,0,8"
                    Visibility="Collapsed">
                <StackPanel>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock x:Name="StatusIcon"
                                   FontFamily="Segoe Fluent Icons"
                                   FontSize="12"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   Margin="0,0,6,0"
                                   VerticalAlignment="Center" />
                        <TextBlock x:Name="StatusText"
                                   FontSize="11"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   TextWrapping="Wrap" />
                    </StackPanel>

                    <!-- Progress bar for AI processing -->
                    <ProgressBar x:Name="AIProgressBar"
                                 Height="3" Margin="0,6,0,0"
                                 IsIndeterminate="True"
                                 Visibility="Collapsed"
                                 Background="{StaticResource PanelBrush}"
                                 Foreground="{StaticResource AccentBrush}"
                                 BorderThickness="0" />
                </StackPanel>
            </Border>

            <!-- Results / Bounding box preview -->
            <StackPanel Grid.Row="7" Margin="0,4,0,0">
                <!-- Bounding box info when available -->
                <Border x:Name="ResultsPanel"
                        Visibility="Collapsed"
                        Background="{StaticResource SurfaceBrush}"
                        CornerRadius="4" Padding="8,6"
                        Margin="0,0,0,8">
                    <StackPanel>
                        <DockPanel>
                            <TextBlock Text="Tracking Results" FontSize="11"
                                       FontWeight="SemiBold"
                                       Foreground="{StaticResource TextPrimaryBrush}" />
                            <TextBlock x:Name="ResultsFrameCount" DockPanel.Dock="Right"
                                       HorizontalAlignment="Right"
                                       FontSize="10"
                                       Foreground="{StaticResource TextSecondaryBrush}" />
                        </DockPanel>

                        <!-- Bounding box coordinates preview -->
                        <Grid Margin="0,6,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0"
                                       x:Name="BBoxXLabel"
                                       FontSize="10" Foreground="{StaticResource TextSecondaryBrush}" />
                            <TextBlock Grid.Row="0" Grid.Column="1"
                                       x:Name="BBoxYLabel"
                                       FontSize="10" Foreground="{StaticResource TextSecondaryBrush}" />
                            <TextBlock Grid.Row="1" Grid.Column="0"
                                       x:Name="BBoxWLabel"
                                       FontSize="10" Foreground="{StaticResource TextSecondaryBrush}" />
                            <TextBlock Grid.Row="1" Grid.Column="1"
                                       x:Name="BBoxHLabel"
                                       FontSize="10" Foreground="{StaticResource TextSecondaryBrush}" />
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Clear results button -->
                <Button x:Name="ClearResultsButton"
                        Style="{StaticResource ToolbarButton}"
                        Click="OnClearResultsClick"
                        HorizontalAlignment="Left"
                        Visibility="Collapsed"
                        Padding="6,3">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock FontFamily="Segoe Fluent Icons"
                                   Text="{StaticResource IconDelete}"
                                   FontSize="11" Margin="0,0,4,0" />
                        <TextBlock Text="Clear Results" FontSize="11" />
                    </StackPanel>
                </Button>
            </StackPanel>
        </Grid>
    </Border>
</UserControl>
